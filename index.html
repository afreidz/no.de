<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <style>
    div {
      font-size: 0;
      box-sizing: border-box;
      background-color: rgba(0, 0, 0, 0.1);
    }

    div.section,
    div.workspace {
      background-color: transparent;
    }

    div.window {
      display: flex;
      font-size: 10px;
      align-items: center;
      justify-content: center;
      border: 1px solid black;
    }

    div.fs {
      z-index: 1;
    }
  </style>

  <script type="module">
    import Window from './build/wm/lib/window.js';
    import Manager from './build/wm/lib/adapters/browser.js';

    const geo = { x: 0, y: 0, w: window.innerWidth, h: window.innerHeight };
    const screens = [geo];
    const manager = new Manager(screens, geo);

    window.addEventListener('mousedown', e => {
      const { x, y } = e;
      manager.drag = { x, y };
    });

    window.addEventListener('mouseup', e => {
      manager.drag = null;
    });

    window.addEventListener('mousemove', e => {
      const { x, y } = e;
      manager.mouse = { x, y };

      if (manager.drag) {
        manager.drag = { x, y };
        // move float
      }

      const win = Window.getByCoords(manager.mouse);
      if (win) manager.activeWin = win;
    });

    window.addEventListener('keyup', e => {
      const arrows = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];

      if (e.ctrlKey && e.key === 'Enter' && !e.metaKey) {
        manager.createWindow();
      } else if (e.ctrlKey && e.metaKey && e.key === 'Enter') {
        manager.createWindow(null, true);
      } else if (e.ctrlKey && e.metaKey && e.key === 'w') {
        manager.destroyWindow(manager.activeWin);
      } else if (e.ctrlKey && arrows.some(a => a === e.key)) {
        const axis = e.key === 'ArrowUp' ? 'n' : e.key === 'ArrowDown' ? 's' : e.key === 'ArrowLeft' ? 'w' : 'e';
        const val = axis === 's' || axis === 'w' ? -10 : 10;
        manager.resize(axis, val);
      }
    });

    window.addEventListener('dblclick', e => {
      if (e.metaKey) {
        manager.toggleFullscreenWin();
      } else {
        manager.toggleFloatWin();
      }
    })

    manager.addWorkspace(0);
  </script>
</head>

<body>

</body>

</html>

